<%@ page contentType="text/html;charset=GBK" language="java" %>
<%@ include file="/YunHaiTongProject/common/taglibs.jsp" %>
<!DOCTYPE html>
<html lang="zh-CN">

	<head>

		<meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta http-equiv="Content-Type" content="text/html;charset=GBK" />
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<meta content="black" name="apple-mobile-web-app-status-bar-style" />
		<meta content="telephone=no" name="format-detection" />
		<meta http-equiv="Cache-Control" content="no-cache" />
		<title>全部评价(0)</title>
		<link rel="stylesheet" href="css/common_css/initialization_style.css" />
		<link rel="stylesheet" href="css/common_css/public_style.css" />
		<link rel="stylesheet" href="css/all_evaluation.css?ts=${ts}" />
		<script type="text/javascript" src="js/common_js/jquery-2.1.4.min.js"></script>
		<script type="text/javascript" src="js/common_js/set_fontsize.js"></script>
	</head>

	<body>

		<!--<div>
			<div class="title_content">全部评价</div>
			<img class="title_back" src="img/back_btn@2x.png" srcset="img/back_btn@2x.png 2x,img/back_btn@3x.png 3x" />
		</div>-->
		<div class="margin_top_six">
			<div class="background_color_FF">
				
				<!--<div class="evaluation_container">
					<div class="evaluation_container_reviewer">
						<img class="evaluation_container_reviewer_pic" src="img/adviser_two@2x.png" srcset="img/adviser_two@2x.png 2x,img/adviser_two@3x.png 3x" />
						<span class="evaluation_container_reviewer_name">JOJO-溪溪</span>
					</div>
					<div class="evaluation_content_box">
						<div class="evaluation_content">
							大家买手机比较来比较去其实吧都差不多，反正我感 觉用的习惯不就好了么！
						</div>
						<div class="comment_goods_pic_container_out">
							<div class="comment_goods_pic_container_in">
								<img class="comment_goods_pic" src="" />
								<img class="comment_goods_pic" src="" />
								<img class="comment_goods_pic" src="" />
							</div>
						</div>
						<div class="evaluation_other_content_box">
							<div class="evaluation_time">06-15 08:52</div>
							<div class="comments_num_box">
								<img class="comment_and_zan_img" src="img/zan_btn@2x.png" srcset="img/zan_btn@2x.png 2x,img/zan_btn@3x.png 3x" />
								<span class="text_vertical_align">5</span>
							</div>
							<div class="zan_num_box">
								<img class="comment_and_zan_img" src="img/comment_icon@2x.png" srcset="img/comment_icon@2x.png 2x,img/comment_icon@3x.png 3x" />
								<span class="text_vertical_align">5</span>
							</div>
						</div>
						<div class="reply_content_box">
							<!--<div class="reply-item">
								<div class="evaluation_content">
									<span class="font_color_black">羊肉烤串：</span>大家买手机比较来比较去其实吧都差不多，反正我感 觉用的习惯不就好了么！就好了么就好了么就好了么
								</div>
								<div class="evaluation_other_content_box">
									<div class="evaluation_time">06-15 08:52</div>
									<div class="comments_num_box">
										<img class="comment_and_zan_img" src="img/zan_btn@2x.png" srcset="img/zan_btn@2x.png 2x,img/zan_btn@3x.png 3x" />
										<span class="text_vertical_align">5</span>
									</div>
								</div>
							</div>
							<div class="rest_reply">查看剩下<span>3</span>条回复</div>
						</div>
						
					</div>
				</div>
				
				<div class="evaluation_container">-->
					<!--<div class="evaluation_container_reviewer">
						<img class="evaluation_container_reviewer_pic" src="img/adviser_two@2x.png" srcset="img/adviser_two@2x.png 2x,img/adviser_two@3x.png 3x" />
						<span class="evaluation_container_reviewer_name">JOJO-溪溪</span>
					</div>
					<div class="evaluation_content_box">
						<div class="evaluation_content">
							大家买手机比较来比较去其实吧都差不多，反正我感 觉用的习惯不就好了么！就好了么就好了么就好了么
						</div>
						<div class="evaluation_other_content_box">
							<div class="evaluation_time">06-15 08:52</div>
							<div class="comments_num_box">
								<img class="comment_and_zan_img" src="img/zan_btn@2x.png" srcset="img/zan_btn@2x.png 2x,img/zan_btn@3x.png 3x" />
								<span class="text_vertical_align">5</span>
							</div>
							<div class="zan_num_box">
								<img class="comment_and_zan_img" src="img/comment_icon@2x.png" srcset="img/comment_icon@2x.png 2x,img/comment_icon@3x.png 3x" />
								<span class="text_vertical_align">5</span>
							</div>
						</div>-->
						<!--<div class="reply_content_box">
							<!--<div class="reply-item">
								<div class="evaluation_content">
									<span class="font_color_black">羊肉烤串：</span>大家买手机比较来比较去其实吧都差不多，反正我感 觉用的习惯不就好了么！就好了么就好了么就好了么
								</div>
								<div class="evaluation_other_content_box">
									<div class="evaluation_time">06-15 08:52</div>
									<div class="comments_num_box">
										<img class="comment_and_zan_img" src="img/zan_btn@2x.png" srcset="img/zan_btn@2x.png 2x,img/zan_btn@3x.png 3x" />
										<span class="text_vertical_align">5</span>
									</div>
									<!--<div class="zan_num_box">
										<img class="comment_and_zan_img" src="img/comment_icon@2x.png" srcset="img/comment_icon@2x.png 2x,img/comment_icon@3x.png 3x" />
										<span class="text_vertical_align">5</span>
									</div>-->
								<!--</div>
							</div>
							<div class="rest_reply">查看剩下<span>3</span>条回复</div>
						</div>
					</div>
				</div>-->
			</div>
		</div>
		<!--评论输入框-->
		<!--<div class="button_div">
			<input type="text" placeholder="请输入评论..." class="comment_all" id="comment_input"/>
			<button class="send_button" id="send_button">发送</button>
		</div>-->

	</body>
	<c:if test="${DEBUG}">
		<script type="text/javascript" src="js/common_js/vconsole.min.js"></script>
	</c:if>
	<script type="text/javascript" src="js/common_js/change_fontsize.js"></script>
	<script type="text/javascript" src="js/common_js/my_tools.js?ts=${ts}"></script>
	<script>
		(function($, document) {
			//设置评论图片的滚动区域长度
			$(".comment_goods_pic_container_in").css("width", "18rem");

		})(jQuery, document);
	</script>

	<script>
		(function($, document) {
			//接收上个页面传过来的被评价商品id
			var request=new queryString();
			var product_id="";//商品id
			if(request["jump_product_id"]){
				product_id=request["jump_product_id"];
			}
			//接口路径（商品详情页--用户晒单）
			//http://120.76.190.223:8988/mrsyg/kqgoods/GoodsComment.form?product=4&pag_no=1&pag_num=3
			var urlPath_two = "mrsyg/kqgoods/GoodsComment.form";
			var need_data_two = {
				"product_id": product_id,
				"pag_no": "1",
				"pag_num": "100"
			};
			var data_two = myAjax(urlPath_two, need_data_two);
			if(data_two != undefined) {
				initTwo(data_two);
			}

			function initTwo(datas) {
				var reply_remain = 0;
				//评论总数
				var comment_sum = datas.comment_sum;
				$("title").text("全部评价(" + comment_sum + ")");
				$.each(datas.commentinfo, function(index, commentdatas) {
					//评论者照片
					var customer_picture = commentdatas.customer_picture;
					//评论者id
					var customer_id = commentdatas.customer_id;
					//评论者名称
					var customer_name = commentdatas.customer_name;
					//评论时间
					var created_at = commentdatas.created_at;
					//评论id
					var comment_id = commentdatas.comment_id;
					//评论内容
					var comment_content = commentdatas.comment_content;
					//照片1
					var picture_one = commentdatas.picture_one;
					//照片2
					var picture_two = commentdatas.picture_two;
					//照片3
					var picture_three = commentdatas.picture_three;
					//回复总数
					var reply_total = commentdatas.reply_total;
					//评论点赞总数
					var comment_like_total = commentdatas.comment_like_total;
					//评论是否点赞
					var comment_like_flag = commentdatas.comment_like_flag;
					console.log("comment_like_flag="+comment_like_flag)
					var str = "";
					var class_add = "";
					if(comment_like_flag==-1){
						str = "img/zan_btn_red@2x.png"
						//$(".fabulous_click").addClass("add_red");
							class_add = "add_red";
					}
					else{
						str = "img/zan_btn@2x.png"
					}
					//评论dom
					var reply = "";
					//评论照片
					var pictureString = "";
					if(picture_one) {
						pictureString = pictureString + '<img class="comment_goods_pic" src="' + picture_one + '"/>';
						if(picture_two) {
							pictureString = pictureString + '<img class="comment_goods_pic" src="' + picture_two + '"/>';
							if(picture_three) {
								pictureString = pictureString + '<img class="comment_goods_pic" src="' + picture_three + '"/>';
							}
						}
					}
					if(0 != reply_total) {
						//剩余评论
						reply_remain = reply_total - 1;
						//回复DOM
						reply = '<div class="reply_content_box">';
						$.each(commentdatas.reply_info, function(index, replydatas) {
							//回复id
							var reply_id = replydatas.reply_id;
							//评论内容
							var reply_content = replydatas.reply_content;
							//回复点赞总数
							var reply_like_total = replydatas.reply_like_total;
							//评论是否点赞
							var reply_like_flag = replydatas.reply_like_flag;
							//创建时间
							var created_at = replydatas.created_at;
							//回复人姓名
							var customer_name = replydatas.customer_name;
							var hideString = '<div class="reply-item" style="display:none;">';
							var displayString = '<div class="reply-item">';
							var replyString = '<div class="evaluation_content">' +
								'<span class="font_color_black">' + customer_name + '：</span>' + reply_content +
								'</div>' +
								'<div class="evaluation_other_content_box">' +
								'<div class="evaluation_time">' + created_at + '</div>' +
								'<div class="comments_num_box">' +
								//'<img class="comment_and_zan_img fabulous_click_red"  src="img/zan_btn_red@2x.png" />'+
								'<img class="comment_and_zan_img fabulous_click"  src="'+str+'" />' +
								'<span class="text_vertical_align">' + reply_like_total + '</span>' +
								'</div>' +
								'</div>' +
								'</div>';
							if(0 == index && reply_remain > 0) {
								replyString += '<div class="rest_reply">查看剩下<span>' + reply_remain + '</span>条回复</div>';
								reply += displayString + replyString;
							} else {
								reply += hideString + replyString;
							}

						});

					}

					var commentString = '<div class="evaluation_container">' +
						'<div class="evaluation_container_reviewer">' +
						'<img class="evaluation_container_reviewer_pic" src="' + customer_picture + '"/>' +
						'<span class="evaluation_container_reviewer_name">' + customer_name + '</span>' +
						'</div>' +
						'<div class="evaluation_content_box">' +
						'<div class="evaluation_content">' + comment_content + '</div>' +
						'<div class="evaluation_other_content_box">' +
						'<div class="comment_goods_pic_container_out">' +
						'<div class="comment_goods_pic_container_in">' + pictureString +
						'</div>' +
						'</div>' +
						'<div class="evaluation_time">' + created_at + '</div>' +
						'<div class="comments_num_box" data-id = "' + comment_id + '">' +
						//'<img class="comment_and_zan_img fabulous_click_red" src="img/zan_btn_red@2x.png" />' +
						'<img class="comment_and_zan_img fabulous_click '+class_add+'" src="'+str+'" />' +
						'<span class="text_vertical_align">' + comment_like_total + '</span>' +
						'</div>' +
						//'<div class="zan_num_box">' +
						//'<img class="comment_and_zan_img" src="img/comment_icon@2x.png" srcset="img/comment_icon@2x.png 2x,img/comment_icon@3x.png 3x" />' +
						//'<span class="text_vertical_align">' + reply_total + '</span>' +
						'</div>' +
						'</div>';
					commentString += reply + '</div></div>';
					$(commentString).appendTo(".background_color_FF");
				});
			}

			//点击查看更多
			$(".rest_reply").click(function(e) {
				$(e.target).css("display", "none");
				$(e.target).nextAll(".reply-item").css("display", "block");
			})
			$(".background_color_FF").on("click",".fabulous_click",function(){
				var str_click = "";
				var fabulous_num = "";
				if($(this).hasClass("add_red")){
					str_click = "img/zan_btn@2x.png";
					fabulous_num = parseInt($(this).parent().find(".text_vertical_align").text()) - 1
					$(this).removeClass("add_red");
				}
				else{
					str_click = "img/zan_btn_red@2x.png";
					fabulous_num = parseInt($(this).parent().find(".text_vertical_align").text()) + 1
					$(this).addClass("add_red");
				}

				$(this).attr('src',str_click);
				$(this).parent().find(".text_vertical_align").text(fabulous_num);
				var comment_id = $(this).parent().attr("data-id");
				//接口路径（商品详情页--用户晒单）
				//http://120.76.190.223:8988/mrsyg/kquser/GoodsLike.form
				var urlPath_fabulous = "mrsyg/kquser/GoodsLike.form";
				var need_data_fabulous = {
					"comment_id": comment_id
				};
				console.log("comment_id="+comment_id);
				var data_fabulous = myAjax(urlPath_fabulous, need_data_fabulous);
				if(data_fabulous != undefined) {
					return true;
				}
			})

			//点击发表按钮
			/*$(".send_button").on("click",function(){

			})*/

			//点击评论弹出
			/*$(".zan_num_box").on("click",".comment_and_zan_img",function(){
			var comment_id = $(this).parents().find(".evaluation_content").attr("data-id");
				$(".button_div").show();
				console.log("comment is comment_id = " + comment_id);
				$(".button_div").find("input").focus();
				var urlPath_comment = "mrsyg/kquser/GoodsLike.form";
					var need_data_comment = {
					"comment_id": comment_id
				};
				var data_comment = myAjax(urlPath_comment, need_data_comment);
				if(data_comment != undefined) {
					return true;
				}
			})*/
		})(jQuery, document);
	</script>

</html>